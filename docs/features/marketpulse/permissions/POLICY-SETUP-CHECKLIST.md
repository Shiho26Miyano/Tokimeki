# MarketPulseS3AccessPolicy è®¾ç½®æ£€æŸ¥æ¸…å•

## âœ… æ­¥éª¤ 1: åˆ›å»º/æ›´æ–°ç­–ç•¥ï¼ˆä½ å·²å®Œæˆï¼‰

ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š
- âœ… ç­–ç•¥åç§°ï¼š`MarketPulseS3AccessPolicy`
- âœ… Service: S3
- âœ… Access level: Limited: List, Read, Write
- âœ… Resource: Multiple
- âœ… Request condition: `s3:prefix` åŒ…å«ï¼š
  - ç©ºå­—ç¬¦ä¸²ï¼ˆæ ¹ç›®å½•ï¼‰
  - `raw-data/*`
  - `processed-data/*`
  - `pulse-events/*`
  - `learning-results/*`

**é…ç½®æ­£ç¡®ï¼** âœ…

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. ä¿å­˜ç­–ç•¥
- ç‚¹å‡» **"Save changes"** æŒ‰é’®ï¼ˆæ©™è‰²æŒ‰é’®ï¼‰
- ç¡®ä¿ **"Set this new version as the default"** å·²å‹¾é€‰ âœ…

### 2. é™„åŠ ç­–ç•¥åˆ°ç”¨æˆ· âš ï¸ **è¿™æ˜¯å…³é”®æ­¥éª¤ï¼**

**å¦‚æœ "Entities attached" æ ‡ç­¾ä¸­æ‰¾ä¸åˆ°ä»»ä½•å®ä½“ï¼Œè¯´æ˜ç­–ç•¥è¿˜æ²¡æœ‰é™„åŠ åˆ°ç”¨æˆ·ï¼**

#### æ–¹æ³• A: ä»ç­–ç•¥é¡µé¢é™„åŠ 

1. åœ¨ç­–ç•¥è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡» **"Entities attached"** æ ‡ç­¾
2. ç‚¹å‡» **"Add"** æˆ– **"Attach"** æŒ‰é’®
3. é€‰æ‹© **"Users"**
4. æœç´¢å¹¶é€‰æ‹©ä½ çš„ç”¨æˆ·
5. ç‚¹å‡» **"Attach"**

#### æ–¹æ³• B: ä»ç”¨æˆ·é¡µé¢é™„åŠ ï¼ˆæ¨èï¼Œæ›´ç›´è§‚ï¼‰

1. è¿›å…¥ **IAM** â†’ **Users**
2. **æ‰¾åˆ°ä½¿ç”¨ä½ çš„ Access Key çš„ç”¨æˆ·**
   - å¦‚æœä¸çŸ¥é“ï¼Œéœ€è¦æŸ¥çœ‹ `.env` æ–‡ä»¶ä¸­çš„ `AWS_ACCESS_KEY_ID`
   - åœ¨ IAM â†’ Users ä¸­é€ä¸ªæ£€æŸ¥ç”¨æˆ·çš„ Access Keys
3. ç‚¹å‡»ç”¨æˆ·å
4. ç‚¹å‡» **Permissions** æ ‡ç­¾
5. ç‚¹å‡» **Add permissions** â†’ **Attach policies directly**
6. åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ `MarketPulseS3AccessPolicy`
7. å‹¾é€‰ç­–ç•¥
8. ç‚¹å‡» **Add permissions**

### 3. éªŒè¯ç­–ç•¥å·²é™„åŠ 

**åœ¨ç­–ç•¥é¡µé¢éªŒè¯ï¼š**
- IAM â†’ Policies â†’ `MarketPulseS3AccessPolicy`
- ç‚¹å‡» **"Entities attached"** æ ‡ç­¾
- âœ… åº”è¯¥èƒ½çœ‹åˆ°ä½ çš„ç”¨æˆ·

**åœ¨ç”¨æˆ·é¡µé¢éªŒè¯ï¼š**
- IAM â†’ Users â†’ ä½ çš„ç”¨æˆ·
- ç‚¹å‡» **"Permissions"** æ ‡ç­¾
- âœ… åº”è¯¥èƒ½çœ‹åˆ° `MarketPulseS3AccessPolicy` åœ¨ "Attached policies" åˆ—è¡¨ä¸­

**å¦‚æœ "Entities attached" ä»ç„¶ä¸ºç©ºï¼Œç­–ç•¥è¿˜æ²¡æœ‰é™„åŠ ï¼**

### 4. ç­‰å¾…æƒé™ç”Ÿæ•ˆ

IAM æƒé™æ›´æ”¹é€šå¸¸éœ€è¦ï¼š
- **10-30 ç§’**ï¼ˆé€šå¸¸ï¼‰
- **æœ€å¤š 1-5 åˆ†é’Ÿ**ï¼ˆæœ‰æ—¶ï¼‰

### 5. é‡å¯åº”ç”¨å¹¶éªŒè¯

1. ç­‰å¾… 1-2 åˆ†é’Ÿ
2. é‡å¯åº”ç”¨ï¼š`python main.py`
3. æ£€æŸ¥æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   INFO: AWS S3 client initialized for bucket: tokimeki-market-pulse-prod
   ```
   è€Œä¸æ˜¯ï¼š
   ```
   WARNING: S3 bucket access forbidden (403)
   ```

## ğŸ” å¦‚æœä»ç„¶ 403ï¼ˆé‡è¦ï¼ï¼‰

å¦‚æœä¿å­˜å¹¶é™„åŠ ç­–ç•¥åä»ç„¶æ”¶åˆ° 403 é”™è¯¯ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

### 1. ç¡®è®¤ç­–ç•¥å·²é™„åŠ åˆ°æ­£ç¡®çš„ç”¨æˆ· âš ï¸

**è¿™æ˜¯æœ€å¸¸è§çš„åŸå› ï¼**

1. åœ¨ AWS Console ä¸­ï¼š
   - è¿›å…¥ **IAM** â†’ **Users**
   - **æ‰¾åˆ°ä½¿ç”¨ä½ çš„ Access Key çš„ç”¨æˆ·**
   - ç‚¹å‡»ç”¨æˆ·å â†’ **Permissions** æ ‡ç­¾
   - æ£€æŸ¥ **"Attached policies"** åˆ—è¡¨

2. **ç¡®è®¤ `MarketPulseS3AccessPolicy` åœ¨åˆ—è¡¨ä¸­**

3. **å¦‚æœä¸åœ¨åˆ—è¡¨ä¸­ï¼š**
   - ç‚¹å‡» **"Add permissions"** â†’ **"Attach policies directly"**
   - æœç´¢ `MarketPulseS3AccessPolicy`
   - å‹¾é€‰ç­–ç•¥
   - ç‚¹å‡» **"Add permissions"**

### 2. ç¡®è®¤ä½¿ç”¨çš„å‡­è¯å¯¹åº”ç”¨æˆ·

**å…³é”®ï¼š** ç­–ç•¥å¿…é¡»é™„åŠ åˆ°**ä½¿ç”¨è¿™äº›å‡­è¯çš„ç”¨æˆ·**ï¼

- æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `AWS_ACCESS_KEY_ID`
- åœ¨ AWS Console ä¸­ï¼š
  - IAM â†’ Users â†’ æ‰¾åˆ°è¿™ä¸ª Access Key å¯¹åº”çš„ç”¨æˆ·
  - ç¡®è®¤ç­–ç•¥å·²é™„åŠ åˆ°è¿™ä¸ªç”¨æˆ·

### 3. ç­‰å¾…æƒé™ç”Ÿæ•ˆ

IAM æƒé™æ›´æ”¹éœ€è¦æ—¶é—´ï¼š
- **é€šå¸¸ï¼š** 10-30 ç§’
- **æœ‰æ—¶ï¼š** 1-5 åˆ†é’Ÿ
- **å»ºè®®ï¼š** ç­‰å¾… 2-3 åˆ†é’Ÿåé‡å¯åº”ç”¨

### 4. æ£€æŸ¥æ˜¯å¦æœ‰ Deny ç­–ç•¥

åœ¨ç”¨æˆ·çš„ Permissions é¡µé¢ï¼š
- æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½• **Deny** ç­–ç•¥
- Deny ç­–ç•¥ä¼šè¦†ç›– Allow ç­–ç•¥

### 5. æ£€æŸ¥ Bucket Policy

S3 â†’ `tokimeki-market-pulse-prod` â†’ Permissions â†’ Bucket policyï¼š
- å¦‚æœæœ‰ Bucket Policyï¼Œç¡®ä¿å®ƒå…è®¸ä½ çš„ç”¨æˆ·è®¿é—®
- æˆ–è€…æš‚æ—¶ç§»é™¤ Bucket Policy æµ‹è¯•

### 6. å°è¯•ç®€åŒ–ç‰ˆæœ¬

å¦‚æœä»¥ä¸Šéƒ½æ­£ç¡®ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬ï¼š
- ä½¿ç”¨ `MarketPulseS3AccessPolicy-SIMPLE.json`
- è¿™ä¸ªç‰ˆæœ¬ç§»é™¤äº† Condition æ¡ä»¶
- å¦‚æœç®€åŒ–ç‰ˆæœ¬å¯ä»¥å·¥ä½œï¼Œè¯´æ˜ Condition æ¡ä»¶æœ‰é—®é¢˜

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] ç­–ç•¥å·²ä¿å­˜ï¼ˆç‚¹å‡»äº† "Save changes"ï¼‰
- [ ] ç­–ç•¥å·²é™„åŠ åˆ°ç”¨æˆ·
- [ ] ç­‰å¾…äº† 1-2 åˆ†é’Ÿ
- [ ] é‡å¯äº†åº”ç”¨
- [ ] æ£€æŸ¥æ—¥å¿—ç¡®è®¤ S3 å®¢æˆ·ç«¯å·²åˆå§‹åŒ–

## ğŸ’¡ æç¤º

ä»ä½ çš„æˆªå›¾çœ‹ï¼Œç­–ç•¥é…ç½®å®Œå…¨æ­£ç¡®ï¼åªéœ€è¦ï¼š
1. ç‚¹å‡» **"Save changes"**
2. é™„åŠ ç­–ç•¥åˆ°ç”¨æˆ·
3. ç­‰å¾…å¹¶é‡å¯åº”ç”¨

åº”è¯¥å°±å¯ä»¥è§£å†³é—®é¢˜äº†ï¼
