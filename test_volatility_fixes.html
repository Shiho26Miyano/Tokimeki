<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volatility Chart Fixes Test</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .chart-container { width: 800px; height: 400px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Volatility Chart Fixes Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Validation Functions</h3>
        <div id="validation-test"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Chart Rendering with Valid Data</h3>
        <div id="chart-test" class="chart-container"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Chart Rendering with Invalid Data</h3>
        <div id="invalid-chart-test" class="chart-container"></div>
    </div>

    <script>
        // Test validation functions
        function testValidationFunctions() {
            const results = [];
            
            // Test isValidNumber
            results.push({
                test: 'isValidNumber with valid number',
                expected: true,
                actual: isValidNumber(42)
            });
            
            results.push({
                test: 'isValidNumber with NaN',
                expected: false,
                actual: isValidNumber(NaN)
            });
            
            results.push({
                test: 'isValidNumber with null',
                expected: false,
                actual: isValidNumber(null)
            });
            
            // Test isValidDate
            results.push({
                test: 'isValidDate with valid date',
                expected: true,
                actual: isValidDate('2023-01-01')
            });
            
            results.push({
                test: 'isValidDate with invalid date',
                expected: false,
                actual: isValidDate('invalid-date')
            });
            
            results.push({
                test: 'isValidDate with null',
                expected: false,
                actual: isValidDate(null)
            });
            
            // Display results
            const container = document.getElementById('validation-test');
            let html = '<h4>Validation Test Results:</h4>';
            
            results.forEach(result => {
                const status = result.expected === result.actual ? 'success' : 'error';
                html += `<div class="${status}">${result.test}: ${result.actual} (expected: ${result.expected})</div>`;
            });
            
            container.innerHTML = html;
        }
        
        // Test chart rendering with valid data
        function testValidChartRendering() {
            const validData = {
                dates: ['2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05'],
                volatility: [10.5, 12.3, 9.8, 11.2, 13.1],
                event_titles: [[], [], [], [], []],
                min_vol_date: '2023-01-03'
            };
            
            const container = document.getElementById('chart-test');
            container.innerHTML = '<div id="test-chart"></div>';
            
            try {
                renderVolatilityCorrelationChart(validData);
                container.innerHTML += '<div class="success">✅ Valid chart rendered successfully</div>';
            } catch (error) {
                container.innerHTML += `<div class="error">❌ Error rendering valid chart: ${error.message}</div>`;
            }
        }
        
        // Test chart rendering with invalid data
        function testInvalidChartRendering() {
            const invalidData = {
                dates: ['2023-01-01', 'invalid-date', '2023-01-03'],
                volatility: [10.5, NaN, 9.8],
                event_titles: [[], [], []],
                min_vol_date: '2023-01-03'
            };
            
            const container = document.getElementById('invalid-chart-test');
            container.innerHTML = '<div id="test-invalid-chart"></div>';
            
            try {
                renderVolatilityCorrelationChart(invalidData);
                container.innerHTML += '<div class="success">✅ Invalid chart handled gracefully</div>';
            } catch (error) {
                container.innerHTML += `<div class="error">❌ Error handling invalid chart: ${error.message}</div>`;
            }
        }
        
        // Initialize tests
        document.addEventListener('DOMContentLoaded', function() {
            testValidationFunctions();
            testValidChartRendering();
            testInvalidChartRendering();
        });
    </script>
    
    <script src="static/main.js?v=20241203"></script>
</body>
</html> 