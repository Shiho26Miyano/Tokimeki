<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Busting Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üîÑ Cache Busting Test</h1>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5>Test Results</h5>
            </div>
            <div class="card-body">
                <div id="results">
                    <p>Starting cache busting tests...</p>
                </div>
            </div>
        </div>
        
        <button class="btn btn-primary" onclick="testDynamicLoad()">Test Dynamic Load</button>
        <button class="btn btn-secondary" onclick="clearCache()">Clear & Reload</button>
    </div>

    <!-- Test 1: Inline script -->
    <script>
        console.log('Inline script works');
        document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Inline script executed</p>';
        
        // Add timestamp to show when page loaded
        document.getElementById('results').innerHTML += '<p>Page loaded at: ' + new Date().toISOString() + '</p>';
    </script>

    <!-- Test 2: Unique external script with cache busting -->
    <script>
        const timestamp = Date.now();
        const scriptUrl = '/static/js/test-unique.js?t=' + timestamp;
        
        document.getElementById('results').innerHTML += '<p>Attempting to load: <code>' + scriptUrl + '</code></p>';
        
        const script = document.createElement('script');
        script.src = scriptUrl;
        script.onload = () => {
            document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Unique script loaded successfully</p>';
            
            if (window.uniqueTestLoaded) {
                document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Script executed: timestamp = ' + window.testTimestamp + '</p>';
            } else {
                document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Script loaded but did not execute</p>';
            }
        };
        script.onerror = (error) => {
            document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Script failed to load: ' + error + '</p>';
        };
        
        document.head.appendChild(script);
    </script>

    <script>
        function testDynamicLoad() {
            const timestamp = Date.now();
            const testUrl = '/static/js/test-basic.js?t=' + timestamp;
            
            document.getElementById('results').innerHTML += '<p>üîÑ Testing dynamic load: <code>' + testUrl + '</code></p>';
            
            fetch(testUrl)
                .then(response => {
                    document.getElementById('results').innerHTML += '<p>Fetch response status: ' + response.status + '</p>';
                    return response.text();
                })
                .then(content => {
                    document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Fetch successful, content length: ' + content.length + '</p>';
                    document.getElementById('results').innerHTML += '<p>Content: <code>' + content.substring(0, 100) + '...</code></p>';
                    
                    // Try to execute it
                    try {
                        eval(content);
                        document.getElementById('results').innerHTML += '<p style="color: green;">‚úÖ Content evaluated successfully</p>';
                        
                        if (window.basicTestLoaded) {
                            document.getElementById('results').innerHTML += '<p style="color: green;">üéâ basicTestLoaded is now true!</p>';
                        } else {
                            document.getElementById('results').innerHTML += '<p style="color: orange;">‚ö†Ô∏è Content evaluated but basicTestLoaded not set</p>';
                        }
                    } catch (evalError) {
                        document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Eval error: ' + evalError.message + '</p>';
                    }
                })
                .catch(error => {
                    document.getElementById('results').innerHTML += '<p style="color: red;">‚ùå Fetch error: ' + error.message + '</p>';
                });
        }
        
        function clearCache() {
            // Clear any cached variables
            window.basicTestLoaded = undefined;
            window.uniqueTestLoaded = undefined;
            window.testTimestamp = undefined;
            
            // Reload with cache busting
            window.location.href = window.location.href + '?t=' + Date.now();
        }
    </script>
</body>
</html>
