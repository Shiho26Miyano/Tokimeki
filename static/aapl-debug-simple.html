<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAPL Dashboard Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>üîß AAPL Dashboard Debug</h1>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5>Loading Status</h5>
            </div>
            <div class="card-body">
                <div id="debug-results">
                    <p>Checking component loading...</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5>Dashboard</h5>
            </div>
            <div class="card-body">
                <div id="aapl-dashboard-root" style="min-height: 300px;">
                    <div class="text-center p-5">
                        <div class="spinner-border text-secondary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading AAPL Analysis Dashboard...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug script -->
    <script>
        function updateDebug(message, isError = false) {
            const debugDiv = document.getElementById('debug-results');
            const color = isError ? 'red' : 'green';
            debugDiv.innerHTML += `<p style="color: ${color};">${isError ? '‚ùå' : '‚úÖ'} ${message}</p>`;
            console.log(message);
        }
        
        // Check initial state
        updateDebug(`React available: ${typeof React !== 'undefined'}`);
        updateDebug(`ReactDOM available: ${typeof ReactDOM !== 'undefined'}`);
        updateDebug(`Babel available: ${typeof Babel !== 'undefined'}`);
    </script>

    <!-- Load AAPL Dashboard component -->
    <script type="text/babel" src="/static/js/components/aapl-analysis-dashboard.js"></script>
    
    <!-- Render component -->
    <script type="text/babel">
        function checkAndRender() {
            updateDebug(`AAPLAnalysisDashboard available: ${!!window.AAPLAnalysisDashboard}`);
            
            if (window.AAPLAnalysisDashboard) {
                try {
                    const rootElement = document.getElementById('aapl-dashboard-root');
                    rootElement.innerHTML = '';
                    
                    if (ReactDOM.createRoot) {
                        const root = ReactDOM.createRoot(rootElement);
                        root.render(React.createElement(window.AAPLAnalysisDashboard));
                        updateDebug('Component rendered successfully with React 18!');
                    } else {
                        ReactDOM.render(React.createElement(window.AAPLAnalysisDashboard), rootElement);
                        updateDebug('Component rendered successfully with React 17!');
                    }
                } catch (error) {
                    updateDebug(`Render error: ${error.message}`, true);
                    console.error('Full error:', error);
                }
            } else {
                updateDebug('AAPLAnalysisDashboard not found, retrying in 1 second...', true);
                setTimeout(checkAndRender, 1000);
            }
        }
        
        // Start checking after a brief delay
        setTimeout(checkAndRender, 500);
    </script>
</body>
</html>
