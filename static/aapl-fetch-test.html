<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAPL Fetch Component Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üîÑ AAPL Fetch Component Test</h1>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5>Loading Progress</h5>
            </div>
            <div class="card-body">
                <div id="progress">
                    <p>Starting tests...</p>
                </div>
            </div>
        </div>
        
        <div id="component-root">
            <div class="alert alert-info">Component will render here...</div>
        </div>
    </div>

    <!-- Load React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script>
        document.getElementById('progress').innerHTML += '<p style="color: green;">‚úÖ React loaded</p>';
    </script>

    <!-- Load ReactDOM -->
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script>
        document.getElementById('progress').innerHTML += '<p style="color: green;">‚úÖ ReactDOM loaded</p>';
    </script>

    <script>
        async function loadComponentViaFetch() {
            try {
                document.getElementById('progress').innerHTML += '<p style="color: blue;">üîÑ Fetching component via fetch API...</p>';
                
                // Test 1: Fetch the minimal test component
                const response = await fetch('/static/js/components/test-minimal.js');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const scriptContent = await response.text();
                document.getElementById('progress').innerHTML += '<p style="color: green;">‚úÖ Component content fetched successfully</p>';
                document.getElementById('progress').innerHTML += '<p>Content length: ' + scriptContent.length + ' characters</p>';
                
                // Show first 200 characters
                document.getElementById('progress').innerHTML += '<p>First 200 chars: <code>' + scriptContent.substring(0, 200) + '...</code></p>';
                
                // Test 2: Try to evaluate the script
                try {
                    eval(scriptContent);
                    document.getElementById('progress').innerHTML += '<p style="color: green;">‚úÖ Script evaluated successfully</p>';
                    
                    // Test 3: Check if component was created
                    setTimeout(() => {
                        if (typeof window.TestComponent !== 'undefined') {
                            document.getElementById('progress').innerHTML += '<p style="color: green;">üéâ TestComponent found after eval!</p>';
                            
                            // Test 4: Try to render it
                            try {
                                const container = document.getElementById('component-root');
                                if (ReactDOM.createRoot) {
                                    const root = ReactDOM.createRoot(container);
                                    root.render(React.createElement(window.TestComponent));
                                } else {
                                    ReactDOM.render(React.createElement(window.TestComponent), container);
                                }
                                document.getElementById('progress').innerHTML += '<p style="color: green;">üöÄ Component rendered successfully!</p>';
                            } catch (renderError) {
                                document.getElementById('progress').innerHTML += '<p style="color: red;">‚ùå Render error: ' + renderError.message + '</p>';
                            }
                        } else {
                            document.getElementById('progress').innerHTML += '<p style="color: red;">‚ùå TestComponent not found after eval</p>';
                            
                            // Show what's on the window object
                            const windowKeys = Object.keys(window).filter(key => 
                                key.includes('Test') || key.includes('Component') || key.includes('AAPL')
                            );
                            document.getElementById('progress').innerHTML += '<p>Window keys: [' + windowKeys.join(', ') + ']</p>';
                        }
                    }, 1000);
                    
                } catch (evalError) {
                    document.getElementById('progress').innerHTML += '<p style="color: red;">‚ùå Eval error: ' + evalError.message + '</p>';
                    document.getElementById('progress').innerHTML += '<p style="color: red;">Stack: ' + evalError.stack + '</p>';
                }
                
            } catch (fetchError) {
                document.getElementById('progress').innerHTML += '<p style="color: red;">‚ùå Fetch error: ' + fetchError.message + '</p>';
            }
        }
        
        // Start the test after React is loaded
        setTimeout(loadComponentViaFetch, 1000);
    </script>
</body>
</html>
