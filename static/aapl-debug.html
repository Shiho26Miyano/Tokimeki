<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAPL Dashboard Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>AAPL Dashboard Debug Page</h1>
        <div id="debug-info" class="alert alert-info">
            <h4>Loading Status:</h4>
            <ul id="status-list">
                <li>Initializing...</li>
            </ul>
        </div>
        <div id="aapl-dashboard-root"></div>
    </div>

    <script type="text/babel">
        function updateStatus(message) {
            const statusList = document.getElementById('status-list');
            const li = document.createElement('li');
            li.textContent = message;
            statusList.appendChild(li);
            console.log(message);
        }

        // Check dependencies
        updateStatus(`React available: ${typeof React !== 'undefined'}`);
        updateStatus(`ReactDOM available: ${typeof ReactDOM !== 'undefined'}`);
        updateStatus(`Babel available: ${typeof Babel !== 'undefined'}`);

        // Simple test component
        function SimpleAAPLDashboard() {
            const [data, setData] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);

            const loadData = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch('/api/v1/aapl-analysis/prices/AAPL?start_date=2024-09-01&end_date=2024-09-28');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    const result = await response.json();
                    setData(result);
                    updateStatus('✅ Data loaded successfully');
                } catch (err) {
                    setError(err.message);
                    updateStatus(`❌ Error: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            React.useEffect(() => {
                loadData();
            }, []);

            return (
                <div className="card">
                    <div className="card-header">
                        <h3>Simple AAPL Dashboard Test</h3>
                    </div>
                    <div className="card-body">
                        {loading && <div className="alert alert-info">Loading...</div>}
                        {error && <div className="alert alert-danger">Error: {error}</div>}
                        {data && (
                            <div>
                                <p><strong>Ticker:</strong> {data.ticker}</p>
                                <p><strong>Data Points:</strong> {data.count}</p>
                                <p><strong>Date Range:</strong> {data.from_date} to {data.to_date}</p>
                                <p><strong>Source:</strong> {data.source}</p>
                                <button className="btn btn-primary" onClick={loadData}>
                                    Refresh Data
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Try to render
        try {
            updateStatus('Attempting to render component...');
            const rootElement = document.getElementById('aapl-dashboard-root');
            const { createRoot } = ReactDOM;
            
            if (createRoot) {
                // React 18 style
                const root = createRoot(rootElement);
                root.render(<SimpleAAPLDashboard />);
            } else {
                // React 17 style fallback
                ReactDOM.render(<SimpleAAPLDashboard />, rootElement);
            }
            updateStatus('✅ Component rendered successfully');
        } catch (error) {
            updateStatus(`❌ Render error: ${error.message}`);
            console.error('Full error:', error);
        }
    </script>
</body>
</html>
