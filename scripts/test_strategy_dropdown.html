<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Dropdown Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>ðŸŽ¯ Futures Trading Strategy Dropdown Test</h2>
        <p class="text-muted">This page tests if the strategy dropdown is working correctly</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Strategy Selection</h5>
                    </div>
                    <div class="card-body">
                        <label class="form-label">Select Trading Strategy:</label>
                        <select class="form-select" id="fq-strategy-select">
                            <option value="">Loading strategies...</option>
                        </select>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="testStrategyChange()">
                                Test Strategy Change
                            </button>
                            <button class="btn btn-secondary" onclick="reloadStrategies()">
                                Reload Strategies
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Strategy Details</h5>
                    </div>
                    <div class="card-body">
                        <div id="fq-strategy-details">
                            <p class="text-muted">Select a strategy to see details...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Console Output</h5>
                    </div>
                    <div class="card-body">
                        <div id="console-output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                            <div>Console output will appear here...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock console.log to capture output
        const originalConsoleLog = console.log;
        const consoleOutput = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // Strategy management class
        class StrategyManager {
            constructor() {
                this.futuresStrategies = [
                    { 
                        id: 1, 
                        name: 'Aggressive Mean Reversion', 
                        description: 'High-risk mean reversion for volatile futures markets',
                        riskLevel: 'High',
                        timeframe: '5 minutes to 1 hour',
                        bestFor: 'Volatile markets, short-term trades, experienced traders',
                        howItWorks: 'Identifies when futures prices move too far from their average and bets they\'ll return to normal levels. Uses aggressive position sizing for maximum profit potential.',
                        avgGain: '0.1193% per 30-min trade'
                    },
                    { 
                        id: 2, 
                        name: 'Conservative Trend Following', 
                        description: 'Low-risk trend following with tight stops',
                        riskLevel: 'Low',
                        timeframe: '1 hour to 4 hours',
                        bestFor: 'Stable trends, swing trading, risk-averse traders',
                        howItWorks: 'Follows established futures trends with multiple confirmation signals. Uses tight stop losses and position scaling for risk management.',
                        avgGain: '0.085% per 2-hour trade'
                    },
                    { 
                        id: 3, 
                        name: 'Volatility Breakout', 
                        description: 'Trade breakouts from low volatility periods',
                        riskLevel: 'Medium',
                        timeframe: '15 minutes to 2 hours',
                        bestFor: 'Range-bound markets, volatility expansion, breakout traders',
                        howItWorks: 'Monitors futures volatility and enters positions when price breaks out of low volatility ranges with volume confirmation.',
                        avgGain: '0.156% per breakout trade'
                    },
                    { 
                        id: 4, 
                        name: 'Momentum Continuation', 
                        description: 'Follow strong momentum in futures markets',
                        riskLevel: 'Medium-High',
                        timeframe: '30 minutes to 3 hours',
                        bestFor: 'Strong trending markets, momentum traders, trend followers',
                        howItWorks: 'Rides strong futures momentum using multiple timeframe analysis and trailing stops to maximize trend profits.',
                        avgGain: '0.203% per momentum trade'
                    },
                    { 
                        id: 5, 
                        name: 'Range Trading', 
                        description: 'Trade within established support/resistance levels',
                        riskLevel: 'Low-Medium',
                        timeframe: '1 hour to 6 hours',
                        bestFor: 'Sideways markets, range traders, mean reversion',
                        howItWorks: 'Identifies key support and resistance levels in futures markets and trades bounces within established ranges.',
                        avgGain: '0.067% per range trade'
                    },
                    { 
                        id: 6, 
                        name: 'News Event Trading', 
                        description: 'Trade around major economic announcements',
                        riskLevel: 'Very High',
                        timeframe: '5 minutes to 30 minutes',
                        bestFor: 'News traders, event-driven strategies, high-frequency trading',
                        howItWorks: 'Trades futures around major economic events using pre-news positioning and post-news momentum strategies.',
                        avgGain: '0.342% per news event'
                    }
                ];
            }

            loadStrategies() {
                console.log('Loading futures trading strategies...');
                
                const strategySelect = document.getElementById('fq-strategy-select');
                console.log('Strategy select element:', strategySelect);
                
                if (strategySelect) {
                    // Clear existing options
                    strategySelect.innerHTML = '';
                    
                    // Add strategy options
                    this.futuresStrategies.forEach(strategy => {
                        const option = document.createElement('option');
                        option.value = strategy.id;
                        option.textContent = strategy.name;
                        strategySelect.appendChild(option);
                        console.log('Added futures strategy:', strategy.name);
                    });
                    
                    // Automatically select the first strategy
                    if (this.futuresStrategies.length > 0) {
                        strategySelect.value = this.futuresStrategies[0].id;
                        console.log('Auto-selecting strategy:', this.futuresStrategies[0].name);
                        
                        // Load strategy details
                        this.loadStrategyData(this.futuresStrategies[0].id);
                    }
                    
                    // Add change event listener to update strategy display
                    strategySelect.addEventListener('change', (e) => {
                        const selectedStrategyId = e.target.value;
                        if (selectedStrategyId) {
                            const selectedStrategy = this.futuresStrategies.find(s => s.id == selectedStrategyId);
                            if (selectedStrategy) {
                                console.log('Strategy changed to:', selectedStrategy.name);
                                this.loadStrategyData(selectedStrategy.id);
                            }
                        }
                    });
                    
                    console.log('Futures strategies loaded:', this.futuresStrategies.length);
                } else {
                    console.error('Strategy select element not found!');
                }
            }

            loadStrategyData(strategyId) {
                console.log('Loading futures strategy data for ID:', strategyId);
                if (!strategyId) {
                    console.log('No strategy ID provided, returning');
                    return;
                }
                
                try {
                    const strategy = this.futuresStrategies.find(s => s.id == strategyId);
                    console.log('Found futures strategy:', strategy);
                    if (strategy) {
                        this.updateStrategyDisplay(strategy);
                    } else {
                        console.warn('Futures strategy not found for ID:', strategyId);
                    }
                } catch (error) {
                    console.error('Error loading futures strategy data:', error);
                }
            }

            updateStrategyDisplay(strategy) {
                console.log('Updating futures strategy display for:', strategy.name);
                const strategyDetails = document.getElementById('fq-strategy-details');
                
                if (strategyDetails) {
                    // Create detailed futures strategy information
                    const riskColor = {
                        'Low': 'bg-success',
                        'Low-Medium': 'bg-info',
                        'Medium': 'bg-warning',
                        'Medium-High': 'bg-orange',
                        'High': 'bg-danger',
                        'Very High': 'bg-dark'
                    };
                    
                    const strategyInfo = `
                        <div class="alert alert-info mb-3">
                            <h6 class="text-primary mb-2">
                                <i class="fas fa-chart-line"></i> ${strategy.name}
                            </h6>
                            <p class="small mb-2"><strong>Description:</strong> ${strategy.description}</p>
                            <p class="small mb-2"><strong>Best For:</strong> ${strategy.bestFor}</p>
                            <p class="small mb-2"><strong>Risk Level:</strong> <span class="badge ${riskColor[strategy.riskLevel]}">${strategy.riskLevel}</span></p>
                            <p class="small mb-0"><strong>Timeframe:</strong> ${strategy.timeframe}</p>
                        </div>
                        <div class="small text-muted mb-3">
                            <strong>How it works:</strong> ${strategy.howItWorks}
                        </div>
                        <div class="alert alert-success mb-0 py-2 small">
                            <i class="fas fa-chart-area"></i> <strong>Performance:</strong> Average gain of ${strategy.avgGain}
                        </div>
                    `;
                    
                    strategyDetails.innerHTML = strategyInfo;
                    console.log('Futures strategy display updated');
                } else {
                    console.error('Strategy details element not found');
                }
            }
        }

        // Initialize strategy manager
        const strategyManager = new StrategyManager();

        // Load strategies when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing strategy dropdown...');
            strategyManager.loadStrategies();
        });

        // Test functions
        function testStrategyChange() {
            console.log('Testing strategy change functionality...');
            const strategySelect = document.getElementById('fq-strategy-select');
            if (strategySelect && strategySelect.options.length > 1) {
                // Change to a different strategy
                const currentIndex = strategySelect.selectedIndex;
                const newIndex = (currentIndex + 1) % strategySelect.options.length;
                strategySelect.selectedIndex = newIndex;
                
                // Trigger change event
                const event = new Event('change');
                strategySelect.dispatchEvent(event);
                
                console.log(`Changed strategy from index ${currentIndex} to ${newIndex}`);
            } else {
                console.log('No strategies available to test');
            }
        }

        function reloadStrategies() {
            console.log('Reloading strategies...');
            strategyManager.loadStrategies();
        }
    </script>
</body>
</html>
