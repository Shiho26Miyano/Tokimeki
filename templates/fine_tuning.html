<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üßë‚Äçüî¨ Model Fine-Tuning (Educational) - Tokimeki</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .explanation { background: #f8fafc; border-left: 4px solid #183153; padding: 1rem; margin-bottom: 2rem; }
        .resource-list { margin-top: 1rem; }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4">üßë‚Äçüî¨ Model Fine-Tuning (Educational)</h1>
    <div class="explanation">
        <h4>What is Fine-Tuning?</h4>
        <p>
            <b>Fine-tuning</b> is the process of taking a pre-trained machine learning model (like BERT or GPT) and training it further on your own data for a specific task (such as sentiment analysis, spam detection, or topic classification). This allows you to leverage the general knowledge of large models and adapt them to your unique needs.
        </p>
        <h5>Use Cases</h5>
        <ul>
            <li>Classifying customer reviews as positive/negative</li>
            <li>Detecting spam emails</li>
            <li>Customizing chatbots for your business</li>
            <li>Medical or legal text classification</li>
        </ul>
        <h5>How to Fine-Tune</h5>
        <ol>
            <li>Choose a pre-trained model (e.g., <code>bert-base-uncased</code> from Hugging Face)</li>
            <li>Prepare your dataset (CSV with <code>text</code> and <code>label</code> columns)</li>
            <li>Adjust hyperparameters (epochs, batch size, learning rate, etc.)</li>
            <li>Run the fine-tuning script (see below)</li>
            <li>Evaluate and use your new model!</li>
        </ol>
        <h5>Concepts</h5>
        <ul>
            <li><b>Transfer Learning:</b> Using knowledge from a large model for your task</li>
            <li><b>Hyperparameters:</b> Settings like learning rate, batch size, and epochs that affect training</li>
            <li><b>Overfitting:</b> When a model learns the training data too well and doesn't generalize</li>
            <li><b>Validation:</b> Checking model performance on unseen data</li>
        </ul>
    </div>

    <div class="card mb-4">
        <div class="card-header"><b>Try Fine-Tuning Yourself!</b></div>
        <div class="card-body">
            <form id="fine-tune-form">
                <div class="mb-3">
                    <label class="form-label">Pre-trained Model</label>
                    <select class="form-control" id="model-name">
                        <option value="bert-base-uncased">BERT Base Uncased</option>
                        <option value="distilbert-base-uncased">DistilBERT Base Uncased</option>
                        <option value="roberta-base">RoBERTa Base</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Dataset (CSV file, <code>text</code> & <code>label</code> columns)</label>
                    <input type="file" class="form-control" id="dataset-file" accept=".csv" required>
                    <div class="form-text">Upload a CSV file with 'text' and 'label' columns</div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Epochs</label>
                        <input type="number" class="form-control" id="epochs" value="2" min="1" max="10">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Batch Size</label>
                        <input type="number" class="form-control" id="batch-size" value="8" min="1" max="64">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Learning Rate</label>
                        <input type="number" class="form-control" id="learning-rate" value="2e-5" step="any">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="start-btn">
                    <span class="spinner-border spinner-border-sm d-none" id="loading-spinner"></span>
                    Start Fine-Tuning
                </button>
            </form>
            <div id="fine-tune-status" class="mt-3"></div>
            
            <!-- Job Status Section -->
            <div class="mt-4" id="job-status-section" style="display: none;">
                <h5>Fine-Tuning Progress</h5>
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span id="job-status-text">Preparing...</span>
                            <span id="job-progress">0%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" id="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted" id="job-message">Initializing fine-tuning process...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="resource-list">
        <h5>Learn More</h5>
        <ul>
            <li><a href="https://huggingface.co/docs/transformers/training" target="_blank">Hugging Face Transformers Training Guide</a></li>
            <li><a href="https://huggingface.co/models" target="_blank">Hugging Face Model Hub</a></li>
            <li><a href="https://course.fast.ai/Lessons/lesson3.html" target="_blank">fast.ai Transfer Learning</a></li>
            <li><a href="https://www.youtube.com/watch?v=9CLUPq2gRS4" target="_blank">YouTube: Fine-tuning Transformers</a></li>
        </ul>
    </div>
</div>

<script>
// Fine-tuning form handling
document.getElementById('fine-tune-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData();
    const fileInput = document.getElementById('dataset-file');
    const modelSelect = document.getElementById('model-name');
    const epochsInput = document.getElementById('epochs');
    const batchSizeInput = document.getElementById('batch-size');
    const learningRateInput = document.getElementById('learning-rate');
    
    // Validate file
    if (!fileInput.files[0]) {
        alert('Please select a CSV file');
        return;
    }
    
    // Add file to form data
    formData.append('dataset', fileInput.files[0]);
    
    // Add other parameters
    formData.append('model_name', modelSelect.value);
    formData.append('epochs', epochsInput.value);
    formData.append('batch_size', batchSizeInput.value);
    formData.append('learning_rate', learningRateInput.value);
    
    // Show loading state
    const startBtn = document.getElementById('start-btn');
    const spinner = document.getElementById('loading-spinner');
    startBtn.disabled = true;
    spinner.classList.remove('d-none');
    startBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Starting...';
    
    try {
        const response = await fetch('/api/fine-tune/start', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success message
            document.getElementById('fine-tune-status').innerHTML = 
                '<div class="alert alert-success">‚úÖ Fine-tuning job started successfully!</div>';
            
            // Show job status section
            document.getElementById('job-status-section').style.display = 'block';
            
            // Start polling for status
            pollJobStatus(result.job_id);
            
        } else {
            document.getElementById('fine-tune-status').innerHTML = 
                `<div class="alert alert-danger">‚ùå Error: ${result.error}</div>`;
        }
        
    } catch (error) {
        document.getElementById('fine-tune-status').innerHTML = 
            `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
    } finally {
        // Reset button state
        startBtn.disabled = false;
        spinner.classList.add('d-none');
        startBtn.innerHTML = 'Start Fine-Tuning';
    }
});

// Poll job status
async function pollJobStatus(jobId) {
    const maxAttempts = 30; // 5 minutes with 10-second intervals
    let attempts = 0;
    
    const poll = async () => {
        try {
            const response = await fetch(`/api/fine-tune/status/${jobId}`);
            const result = await response.json();
            
            if (result.success) {
                updateJobStatus(result);
                
                if (result.status === 'completed' || result.status === 'failed') {
                    return; // Stop polling
                }
            }
            
            attempts++;
            if (attempts < maxAttempts) {
                setTimeout(poll, 10000); // Poll every 10 seconds
            } else {
                updateJobStatus({
                    status: 'timeout',
                    message: 'Job status polling timed out'
                });
            }
            
        } catch (error) {
            console.error('Error polling job status:', error);
            attempts++;
            if (attempts < maxAttempts) {
                setTimeout(poll, 10000);
            }
        }
    };
    
    poll();
}

// Update job status display
function updateJobStatus(result) {
    const statusText = document.getElementById('job-status-text');
    const progressText = document.getElementById('job-progress');
    const progressBar = document.getElementById('progress-bar');
    const message = document.getElementById('job-message');
    
    let statusClass = 'text-primary';
    let progress = result.progress || 0;
    
    switch (result.status) {
        case 'preparing':
            statusText.textContent = 'Preparing Dataset';
            message.textContent = 'Loading and preprocessing your dataset...';
            break;
        case 'training':
            statusText.textContent = 'Training Model';
            message.textContent = 'Fine-tuning the model on your data...';
            break;
        case 'completed':
            statusText.textContent = 'Completed';
            statusClass = 'text-success';
            message.textContent = 'Fine-tuning completed successfully!';
            progress = 100;
            break;
        case 'failed':
            statusText.textContent = 'Failed';
            statusClass = 'text-danger';
            message.textContent = result.message || 'Fine-tuning failed';
            break;
        case 'timeout':
            statusText.textContent = 'Timeout';
            statusClass = 'text-warning';
            message.textContent = result.message || 'Job status polling timed out';
            break;
        default:
            statusText.textContent = 'Unknown Status';
            message.textContent = result.message || 'Unknown job status';
    }
    
    statusText.className = statusClass;
    progressText.textContent = `${progress}%`;
    progressBar.style.width = `${progress}%`;
    progressBar.className = `progress-bar ${statusClass.replace('text-', 'bg-')}`;
}

// Load available models on page load
async function loadAvailableModels() {
    try {
        const response = await fetch('/api/fine-tune/models');
        const result = await response.json();
        
        if (result.success) {
            const modelSelect = document.getElementById('model-name');
            modelSelect.innerHTML = '';
            
            result.models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = `${model.name} (${model.size_mb}MB)`;
                modelSelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading models:', error);
    }
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadAvailableModels();
});
</script>
</body>
</html> 